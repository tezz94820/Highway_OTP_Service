# Building the Porject

1. Add the below mentioned env variables 
2. `npm install` :- To install all the dependencies.
3. `npm run dev` :- To start the sever in developement mode.
4. `npm start` :- To start the server in production mode. 

# Environment Variables to be added in .env file in the root dir of client folder

1. `PORT` :- Port on which the server will run.
2. `NODE_ENV` :- (developement/production) :- specifies the environment in which the server will run.
3. `MONGO_URI` :- mongodb atlas cluster url for connecting to the mongodb server.
4. `JWT_SECRET` :- This is the secret of JWT which will be used to generate a unique token.
5. `JWT_LIFETIME` :- amount of time the token will be valid for.
6. `EMAIL_FROM` :- Email address using which the emails of OTP will be sent to users.
7. `EMAIL_PASSWORD` :- The password generated by Google for authenticating to third party apps like nodemailer.
8. `CRYPT_PASSWORD` :- This is the password which will be used for encrypting the the details of OTP and generating a verification_code which will be discuused further.
9. `CRYPT_IV` :- the initilization vector for crypto module. (Ex :- 0123456789ABCDEF0123456789ABCDEF)


## Working of OTP module.

1. The User sends the Email to server on which the OTP is to be sent.
    
    `FrontEnd ------(Email)------> server`
2. The server makes the new Entry for the new User in the User collection in mongodb.
3. The server then creates a new OTP and saves it in database . in database only OTP_ID, OTP, expiration_time is stored.
4. We do not store the OTP and email together , as if any person gets hold of our db then the hacker can access the OTP with it's email. 
5. The newly creted OTP,OTP_ID and email is encrypted and a verification code is formed.
    
    `Encryption(OTP + OPT_ID + EMAIL) = verification_code` 
6. The Verification code is then sent to the client's device and being stored in the browser.And the Email with the OTP is sent to client's email.
    
    `OTP -------> client's Email`

    `verification_code -------> client's browser/device`
7. The client will look at the email and put the OTP in the browser. then 2 things will be sent from the browser. First the OTP which user will provide and secondly the verification_code which we sent tp client's device will be attacjed to req and sent to server.

    `OTP(provided_by_client) + verification_code(provided_by_device/browser) ----------> Server`

8. Now the server will decrypt the verification_code and get the OTP_ID. Verification_code is decrypted and OTP_ID and email is extracted from it.

    `Decryption(verification_code) = OTP + OTP_ID _ EMAIL`
    1. If we founf that decryption is unsuccessful then something is tampered. Stop the entire Process. 
    2. Using OTP_ID we will search in the db for and get the assigned OTP , then we will match with the user provided OTP to check if the user has provided it correctly. 
    3. We wi;; also check the email provided by the req and email from decrypted verification_code to check if the correct user has given the OTP.
9. The OTP will be successfully verified.

References :- 
1. Medium Article : https://medium.com/geekculture/how-to-make-a-scalable-otp-service-3df8300941ba
2. Github(Divyansh12) : https://github.com/Divyansh12/node-otp-service/tree/master/models




# Authentication :- 
1. JWT tokens are used for authenticating the users.
2. Brypt is used to hash the password ans store in the database. for safety from hackers even if they get access of database they won't be able to crack the password.
## I have written article on bcrypt talkign in depth how hashing is done using bcrypt and its salt. Even talked about the Rainbow tables  
(https://medium.com/@tejasitankar94820/bcrypt-decoded-the-key-to-unbreakable-passwords-a42c74df6f0b)



